name: Web Server Integration Tests

on:
  workflow_dispatch:
    inputs:
      spring_ai_version:
        description: 'Spring AI Version'
        required: false
        default: '1.0.1'
        type: string

jobs:
  test-web-servers:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        cache: maven
        
    - name: Install JBang
      run: |
        curl -Ls https://sh.jbang.dev | bash -s - app setup
        echo "$HOME/.jbang/bin" >> "$GITHUB_PATH"
        export PATH="$HOME/.jbang/bin:$PATH"
        jbang version
        
    - name: Update Spring AI version
      run: |
        echo "ðŸ“¦ Updating Spring AI version to: ${{ inputs.spring_ai_version }}"
        ./scripts/update-spring-ai-version.sh "${{ inputs.spring_ai_version }}"
        
    - name: Test openai-streaming-response web server
      env:
        OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
      run: |
        echo "ðŸ§ª Testing openai-streaming-response web server..."
        cd misc/openai-streaming-response
        jbang integration-tests/RunOpenaiStreamingResponseWebServer.java
        
    - name: Test weather/starter-webmvc-server MCP server
      run: |
        echo "ðŸ§ª Testing weather/starter-webmvc-server MCP server..."
        cd model-context-protocol/weather/starter-webmvc-server
        jbang integration-tests/RunWeatherStarterWebmvcServerWebServer.java
        
    - name: Summary
      if: always()
      run: |
        echo "âœ… Web server tests completed"
        echo "Check logs in target/integration-test-logs/ for details"